<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Hello World!</title>
  </head>
  <body>
    <canvas id="canvas" width="600" height="400"></canvas>

    <!-- Form to allow user to specify number of lines to draw -->
    <form>
      <label for="numLines">Number of lines:</label>
      <input type="number" id="numLines" value="50" min="1" max="10" />
      <button type="button" id="drawLinesButton">Draw lines</button>
      <button type="button" id="saveAsPNG">Save as PNG</button>
    </form>

    <script>
      // Get reference to canvas element
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Get reference to form elements
      const numLinesInput = document.getElementById("numLines");
      const drawLinesButton = document.getElementById("drawLinesButton");
      const button = document.getElementById("saveAsPNG");

      // Function to draw random lines on canvas
      function drawRandomLines(numLines) {
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas

        // Generate random lines
        for (let i = 0; i < numLines; i++) {
          ctx.beginPath();
          ctx.moveTo(
            Math.random() * canvas.width,
            Math.random() * canvas.height
          );
          ctx.lineTo(
            Math.random() * canvas.width,
            Math.random() * canvas.height
          );
          ctx.stroke();
        }
      }

      // Event listener for draw lines button
      drawLinesButton.addEventListener("click", () => {
        const numLines = numLinesInput.value;
        drawRandomLines(numLines);
      });

      let clicks = [];

      canvas.addEventListener("click", (event) => {
        const rect = canvas.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        // Get the pixel data at the click location
        const imageData = ctx.getImageData(x, y, 1, 1);
        const pixel = imageData.data;

        // Check if pixel is white (255, 255, 255)
        if (pixel[0] === 255 && pixel[1] === 255 && pixel[2] === 255) {
          console.log("Clicked in white space");

          // Add click to array
          clicks.push({ x, y });

          // Draw polygon
          if (clicks.length > 1) {
            ctx.beginPath();
            ctx.moveTo(clicks[0].x, clicks[0].y);
            for (let i = 1; i < clicks.length; i++) {
              ctx.lineTo(clicks[i].x, clicks[i].y);
            }
            ctx.closePath();
            ctx.fill();
          }
        } else {
          console.log("Clicked on a line");
          clicks = []; // Reset clicks array
        }
      });

      // Add the button to the page
      // document.body.appendChild(button);

      // Add an event listener to the button that will be called when the button is clicked
      button.addEventListener("click", () => {
        // Use the canvas element's toDataURL method to get a data URI representing the canvas's contents as a PNG image
        const pngImage = canvas.toDataURL("image/png");

        // Create the link element
        const link = document.createElement("a");

        // Set the link element's href attribute to the data URI
        link.href = pngImage;

        // Set the link element's download attribute to the desired file name for the PNG image
        link.download = "my-image.png";

        // Add the link element to the page
        document.body.appendChild(link);

        // Trigger a click event on the link element to download the PNG image
        link.click();
      });
    </script>
  </body>
</html>
